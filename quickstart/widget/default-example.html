<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
<body>
    <p>The <a href="https://github.com/okta/okta-signin-widget">Okta Sign-In Widget</a> is a JavaScript widget that allows you to customize the Okta Sign-In experience by hosting it on your own page. This guide will walk you through integrating the Sign-In Widget into your custom front-end application by performing these steps:</p>

<ol>
  <li>Add and configure an OpenID Connect Client in Okta</li>
  <li>Add the Sign-In Widget assets to your project</li>
  <li>Configure the Sign-In Widget</li>
  <li>Use the Access Token to authenticate requests</li>
</ol>

<p>At the end of this section can choose your server type to learn more about post-authentication workflows, such as using the access tokens (obtained by the Sign-in Widget) to authenticate requests to your server.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>If you do not already have a <strong>Developer Edition Account</strong>, you can create one at <a href="https://developer.okta.com/signup/">https://developer.okta.com/signup/</a>.</p>

<blockquote>
  <p>Note: The rest of these instructions assume you are using the new Developer Dashboard.  If you already have an Okta Org, you can find the new Developer Dashboard by using the drop-down menu in the upper-left of the current Okta Admin Console.</p>
</blockquote>

<h2 id="add-and-configure-an-openid-connect-client">Add and Configure an OpenID Connect Client</h2>
<ul>
  <li>Log into the Okta Developer Dashboard, click <strong>Applications</strong> then <strong>Add Application</strong>.</li>
  <li>Choose <strong>Single Page App (SPA)</strong> as the platform, then populate your new OpenID Connect application with the values that are correct for your application (such as the port where it is running).  If you  are running this app locally, your settings would look like this:</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Setting</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Application Name</td>
      <td>My Web App</td>
    </tr>
    <tr>
      <td>Base URIs</td>
      <td>http://localhost:{port}</td>
    </tr>
    <tr>
      <td>Login redirect URIs</td>
      <td>http://localhost:{port}</td>
    </tr>
    <tr>
      <td>Grant Types Allowed</td>
      <td>Implicit</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>Note: if your login page is on a different URL, such as <code class="highlighter-rouge">/login</code>, you should change the settings to match.</p>
</blockquote>

<p>After you have created the application there are two more values you will need to gather before continuing, these values will be used in your application to setup the OpenID Connect flow with Okta.</p>

<table>
  <thead>
    <tr>
      <th>Setting</th>
      <th>Where to Find</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Client ID</td>
      <td>On the “General” tab of the application you just created, or the parent list of applications.</td>
    </tr>
    <tr>
      <td>Org URL</td>
      <td>On the home screen of the developer dashboard, in the upper right.</td>
    </tr>
  </tbody>
</table>

<h2 id="add-sign-in-widget-assets-to-your-project">Add Sign-In Widget Assets To Your Project</h2>

<p>The easiest way to get started with the <a href="https://github.com/okta/okta-signin-widget">Okta Sign-In Widget</a> is to load the JS and CSS files directly from the CDN.</p>

<p>To use our CDN, include the following links to your HTML:</p>
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script
</span><span class="na">src=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.1.0/js/okta-sign-in.min.js"</span>
<span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;link</span>
<span class="na">href=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.1.0/css/okta-sign-in.min.css"</span>
<span class="na">type=</span><span class="s">"text/css"</span>
<span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;link</span>
<span class="na">href=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.1.0/css/okta-theme.css"</span>
<span class="na">type=</span><span class="s">"text/css"</span>
<span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">/&gt;</span>
</code></pre>
</div>

<blockquote>
  <p>The <code class="highlighter-rouge">okta-sign-in.min.js</code> file will expose a global <code class="highlighter-rouge">OktaSignIn</code> object that can bootstrap the widget.</p>
</blockquote>

<h2 id="configure-the-sign-in-widget">Configure the Sign-In Widget</h2>

<p>There are many ways to configure the Sign-In Widget, though in this case we will use a configuration that will achieve the following:</p>

<ul>
  <li>Determine if the user has an Okta session, and sign them in if needed</li>
  <li>Perform sign-in by presenting the login form on your page, then redirecting the user to Okta where an SSO session is created before redirecting the user back to your application with an access token and ID Token in the URL fragment (this is the OIDC Implicit flow)</li>
  <li>Store that access token and ID Token that we can use later</li>
</ul>

<p>The widget needs to be rendered to a known element on your page. To do this, add the following to your HTML:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"okta-login-container"</span><span class="nt">&gt;&lt;/div&gt;</span>
    ...
<span class="nt">&lt;/body&gt;</span>
</code></pre>
</div>

<p>Then copy this widget configuration into your front-end application:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">oktaSignIn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OktaSignIn</span><span class="p">({</span>
    <span class="na">baseUrl</span><span class="p">:</span> <span class="s2">"https://{yourOktaDomain}.com"</span><span class="p">,</span>
    <span class="na">clientId</span><span class="p">:</span> <span class="s2">"{yourClientId}"</span><span class="p">,</span>
    <span class="na">authParams</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">issuer</span><span class="p">:</span> <span class="s2">"https://{yourOktaDomain}.com/oauth2/default"</span><span class="p">,</span>
      <span class="na">responseType</span><span class="p">:</span> <span class="p">[</span><span class="s1">'token'</span><span class="p">,</span> <span class="s1">'id_token'</span><span class="p">],</span>
      <span class="na">display</span><span class="p">:</span> <span class="s1">'page'</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">token</span><span class="p">.</span><span class="nx">hasTokensInUrl</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">token</span><span class="p">.</span><span class="nx">parseTokensFromUrl</span><span class="p">(</span>
      <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// The tokens are returned in the order requested by `responseType` above</span>
        <span class="kd">var</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">res</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">idToken</span> <span class="o">=</span> <span class="nx">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">// Say hello to the person who just signed in:</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Hello, '</span> <span class="o">+</span> <span class="nx">idToken</span><span class="p">.</span><span class="nx">claims</span><span class="p">.</span><span class="nx">email</span><span class="p">);</span>

        <span class="c1">// Save the tokens for later use, e.g. if the page gets refreshed:</span>
        <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'accessToken'</span><span class="p">,</span> <span class="nx">accessToken</span><span class="p">);</span>
        <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'idToken'</span><span class="p">,</span> <span class="nx">idToken</span><span class="p">);</span>

        <span class="c1">// Remove the tokens from the window location hash</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="o">=</span><span class="s1">''</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="kd">function</span> <span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle errors as needed</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Session exists, show logged in state.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">'ACTIVE'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Welcome back, '</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">login</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// No session, show the login form</span>
      <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">renderEl</span><span class="p">(</span>
        <span class="p">{</span> <span class="na">el</span><span class="p">:</span> <span class="s1">'#okta-login-container'</span> <span class="p">},</span>
        <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// Nothing to do in this case, the widget will automatically redirect</span>
          <span class="c1">// the user to Okta for authentication, then back to this page if successful</span>
        <span class="p">},</span>
        <span class="kd">function</span> <span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// handle errors as needed</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<p>With the above code in your front-end application, you should see the Sign In Widget when you load your application.  At this point you should be able to login, and be redirected back to your application with an access token and ID Token.  You should have the JavaScript console open in your browser while doing this, it will allow you to see the success messages from the examples and any errors that may arise. Once this is working you can move on to the next section, where we will make use of the access token to make an authenticated request against your server.</p>

<h3 id="use-the-access-token-to-authenticate-requests">Use the Access Token to Authenticate Requests.</h3>

<p>Your application now has an access token in local storage that was issued by your Okta Authorization server. You can use this token to authenticate requests for resources on your server or API. As a hypothetical example, let’s say that you have an API that gives us messages for our user.  You could create a <code class="highlighter-rouge">callMessagesApi</code> function that gets the access token from local storage, and use it to make an authenticated request to your server.</p>

<p>Please continue down to the next section, Server Setup, to learn about access token validation on the server.  Here is what the front-end code could look like for this hypothetical example:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">callMessagesApi</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"accessToken"</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Make the request using jQuery</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="s1">'http://localhost:{serverPort}/api/messages'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">Authorization</span> <span class="p">:</span> <span class="s1">'Bearer '</span> <span class="o">+</span> <span class="nx">accessToken</span><span class="p">.</span><span class="nx">accessToken</span>
    <span class="p">},</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Received messages!</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Messages'</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre>
</div>

</body>
</html>
