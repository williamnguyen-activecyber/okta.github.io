<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
<head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager
    }
	</script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
 	

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="SAML | Okta Developer" />
  <meta class="swiftype" name="summary" data-type="string" content="Enable SSO for your web and mobile applications with SAML." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-816a1293cb727447b038c26bd7277c083eb8c738180d3f42deac694400e3dd32.css">
  
  
  <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="/favicon.ico">
  <title>SAML | Okta Developer</title>
  <meta name="description" content="Enable SSO for your web and mobile applications with SAML.">
  <link rel="canonical" href="https://developer.okta.com/standards/SAML/index">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
</head>

<body>
  <div class="Page saml Page--docs-page">
    <!-- START Header -->
    




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first leaf">
          <a href="https://developer.okta.com/product/">Product</a>
        </li>
        <li class="leaf">
          <a href="/blog/">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/" class="active">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
            <li class="last leaf"><a href="tel:18887227871">1 (888) 722-7871</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
            <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
            <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
            <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
            <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

    <!-- END Header -->
     <!-- START Page Center w/Sub Nav & Content -->
    <section class="PageContent DynamicSidebar has-tableOfContents">
      <!-- START Fixed sidebar --><aside class="Sidebar">
        <h2 class="Sidebar-location Sidebar-toggle h6">Navigation</h2>
        <div class="Sidebar-close Sidebar-toggle"></div>
        <div>
          <h3 class="Sidebar-title">Use Cases</h3>
          <ul class="Sidebar-nav">
            <li>
              <a href="/use_cases/authentication/">Authentication</a>
            </li>
            <li>
              <a href="/use_cases/mfa/">Multi-Factor Authentication</a>
            </li>
            <li>
              <a href="/use_cases/api_access_management/">API Access Management</a>
            </li>
            <li>
              <a href="/use_cases/integrate_with_okta/">Integrate with Okta</a>
            </li>
          </ul>
          <h3 class="Sidebar-title">Reference</h3>
          <ul class="Sidebar-nav">
            <li>
              <a href="/docs/api/getting_started/api_test_client.html">Getting Started</a>
            </li>
            <li>
              <a href="/docs/api/resources/authn.html">Authentication Reference</a>
            </li>
            <li>
              <a href="/docs/api/resources/apps.html">API Reference</a>
            </li>
            <li>
              <a href="/reference/error_codes/">Error Codes</a>
            </li>
            <li>
              <a href="/reference/okta_expression_language/">Okta Expression Language</a>
            </li>
            <li>
              <a href="/docs/platform-release-notes/platform-release-notes.html">Platform Release Notes</a>
            </li>
          </ul>

          <h3 class="Sidebar-title">Standards</h3>
          <ul class="Sidebar-nav">
            
            
            
            <li>
              <a href="/standards/OAuth/">OAuth 2.0 and Okta</a>
            </li>
            
            
            <li>
              <a href="/standards/OIDC/">OpenID Connect and Okta</a>
            </li>
            
            
            <li class="is-active">
              <a href="/standards/SAML/">SAML</a>
            </li>
            
            
            
            
            <li>
              <a href="/standards/SCIM/">SCIM Provisioning with Lifecycle Management</a>
            </li>
            
          </ul>
          <script>
            if (document.querySelectorAll("#Sidebar_Resources .is-active").length) {
                document.getElementById('Sidebar_Resources').classList.remove('Sidebar-hide');
            }

            if (document.querySelectorAll("#Sidebar_References .is-active").length) {
                document.getElementById('Sidebar_References').classList.remove('Sidebar-hide');
            }
          </script>
        </div>
      </aside>
<!-- END Fixed sidebar -->
      <!-- START Page Content -->
      <div class="PageContent-main" id="docs-body">
        <a id="edit-link" href="https://github.com/okta/okta.github.io/edit/master/_source/_standards/SAML/index.md">Edit Page</a>
      <h1 id="introduction">Introduction</h1>

<p>Traditionally, enterprise applications are deployed and run within the company network.  To obtain information about users such as user profile and group information, many of these applications are built to integrate with corporate directories such as Microsoft Active Directory.  More importantly, a user’s credentials are typically stored and validated using the directory.  For example, if you use SharePoint and Exchange that are running on premises, your login credentials are your Active Directory credentials.</p>

<p>However, with increased collaboration and the move towards the cloud, many applications have moved beyond the boundaries of a company’s domain.   Federated Authentication is the solution to this problem.</p>

<h2 id="authentication">Authentication</h2>

<p>Before diving into federated authentication, we need to understand what authentication really means.  Authentication defines the way a user is identified and validated through some sort of credentials as part of a login flow.  Most applications will present a login page to an end user, allowing him to specify a username and a password.  In some cases, additional information may be required in order to locate the user - like a company ID or a client code.  This information allows the application to narrow down the search of the username applicable to the provided info.  This is often used to allow the same username to exist across multiple tenants belonging to different customers.</p>

<p>Most applications will have a user store (DB or LDAP) containing, among other things, user profile information and credentials.  During login, the credentials are validated against this backend user store.  The advantage of this approach is that it is simple, because everything is managed within the application, providing a single and consistent way to authenticate an end user.  However, if a user needs to access multiple applications where each app requires a different set of credentials, it becomes a hassle for the end user.  First, the user will need to remember different passwords – in addition to any other corporate password (eg. AD password) that may already exist.   The user is now forced to maintain separate usernames and passwords, dealing with different password policies and expirations.  Second, this also creates a headache for administrators and ISVs when application users continue to have access to applications that should have been revoked.</p>

<h2 id="federated-identity">Federated Identity</h2>

<p>Federated Identity started with the need to support application access that spans beyond a company or organization boundary.  Imagine a relationship between a juice company (JuiceCo) selling its product to a large supermarket chain (BigMart).  As an employee of JuiceCo, you need to access an application provided by BigMart to manage the relationship and monitor supplies and sales.</p>

<p>In this case, BigMart (who is providing this application) will need to take care of user authentication.  The simple way is to require a different user name and password from users working at JuiceCo.  But think about all the users that this application will need to maintain – including all of the other suppliers and their users who need to access the application.</p>

<p>A more elegant way to solve this problem is to allow JuiceCo and every other supplier to share or “federate” the identities with BigMart.  As an employee of JuiceCo, you already have a corporate identity and credentials. What Federated Identity provides is a secure way for the supermarket chain (Service Provider) to externalize authentication by integrating with its suppliers’ existing identity infrastructure (Identity Provider).  This type of use case is what led to the birth of federated protocols such as <a href="http://en.wikipedia.org/wiki/Security_Assertion_Markup_Language">Secure Assertion Markup Languange (SAML)</a>.</p>

<p>See <a href="http://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-tech-overview-2.0.html">Security Assertion Markup Language (SAML) V2.0 Technical Overview</a> for a in-depth overview.</p>

<h2 id="planning-for-saml">Planning for SAML</h2>

<p>SAML is mostly used as a web-based authentication mechanism inasmuch as it relies on using the browser agent to broker the authentication flow.  At a high-level, the authentication flow of SAML looks like this:</p>

<p><img src="/assets/saml_guidance_saml_flow-28dd48fbbb9ad2f9ff036ef147088c88a0e2901d3093c2fc6d33618eccd77829.png" saml="" flow="" alt="SAML Flow" /></p>

<p>We are now ready to introduce some common SAML terms.  We will go into the technical details of these later – but it is important to understand the high-level concept during the planning stage.</p>

<ul>
  <li>
    <p><strong>A Service Provider (SP)</strong> is the entity providing the service – typically in the form of an application</p>
  </li>
  <li>
    <p><strong>An Identity Provider (IDP)</strong> is the entity providing the identities, including the ability to authenticate a user.  The Identity Provider typically also contains the user profile – additional information about the user such as first name, last name, job code, phone number, address, etc.  Depending on the application, some service providers may require a very simple profile (username, email), while others may require a richer set of user data (job code, department, address, location, manager, etc).</p>
  </li>
  <li>
    <p><strong>A SAML Request</strong>, also known as an authentication request, is generated by the Service Provider to “request” an authentication.</p>
  </li>
  <li>
    <p><strong>A SAML Response</strong> is generated by the Identity Provider.  It contains the actual assertion of the authenticated user.  In addition, a SAML Response may contain additional information, such as user profile information and group/role information, depending on what the Service Provider can support.</p>
  </li>
  <li>
    <p><strong>A Service Provider Initiated (SP-initiated)</strong> login describes the SAML login flow when initiated by the Service Provider.  This is typically triggered when the end user tries to access a resource or login directly on the Service Provider side, such as when the browser tries to access a protected resource on the Service Provider side.</p>
  </li>
  <li>
    <p><strong>An Identity Provider Initiated (IDP-initiated)</strong> login describes the SAML login flow initiated by the Identity Provider.  Instead of the SAML flow being triggered by a redirection from the Service Provider, in this flow the Identity Provider initiates a SAML Response that is redirected to the Service Provider to assert the user’s identity.</p>
  </li>
</ul>

<p>A couple of key things to note:</p>

<ol>
  <li>
    <p>The Service Provider never directly interacts with the Identity Provider.  A browser acts as the agent to carry out all the redirections.</p>
  </li>
  <li>
    <p>The Service Provider needs to know which Identity Provider to redirect to before it has any idea who the user is.</p>
  </li>
  <li>
    <p>The Service Provider does not know who the user is until the SAML assertion comes back from the Identity Provider.</p>
  </li>
  <li>
    <p>This flow does not have to start from the Service Provider.  An Identity Provider can initiate an authentication flow.</p>
  </li>
  <li>
    <p>The SAML authentication flow is asynchronous.  The Service Provider does not know if the Identity Provider will ever complete the entire flow.  Because of this, the Service Provider does not maintain any state of any authentication requests generated.  When the Service Provider receives a response from an Identity Provider, the response must contain all the necessary information.</p>
  </li>
</ol>

<h2 id="planning-checklist">Planning Checklist</h2>

<p>While the SAML protocol is a standard, there are different ways to implement it depending on the nature of your application.  The following is a checklist that will guide you through some of key considerations.</p>

<ol>
  <li>
    <p>Understanding the role of a Service Provider</p>
  </li>
  <li>
    <p>Single IDP vs Multiple IDPs</p>
  </li>
  <li>
    <p>Understanding SP-initiated Login Flow</p>
  </li>
  <li>
    <p>Exposing SAML configuration in SP</p>
  </li>
  <li>
    <p>Enabling SAML for everyone vs a subset of users</p>
  </li>
  <li>
    <p>Implementing a “backdoor”</p>
  </li>
</ol>

<h3 id="understanding-the-role-of-a-service-provider">Understanding the role of a Service Provider</h3>

<p>A SAML IDP generates a SAML response based on configuration that is mutually agreed upon by the IDP and the SP.  Upon receiving the SAML assertion, the SP needs to validate that the assertion comes from a valid IDP and then parse the necessary information from the assertion – the username, attributes, etc.</p>

<p>In order to do this, the SP requires at least the following:</p>

<ul>
  <li>Certificate – The SP needs to obtain the public certificate from the IDP to validate the signature.  The certificate is stored on the SP side and used whenever a SAML response arrives.</li>
  <li>ACS Endpoint – Assertion Consumer Service URL – often referred to simply as the SP login URL.  This is the endpoint provided by the SP where SAML responses are posted.  The SP needs to provide this information to the IDP.</li>
  <li>IDP Login URL – This is the endpoint on the IDP side where SAML requests are posted.  The SP needs to obtain this information from the IDP.</li>
</ul>

<p>The easiest way to implement SAML is to leverage an OpenSource SAML toolkit.  We have included a list at the end of this article of recommended toolkits for several languages.  These toolkits provide the logic needed to digest the information in an incoming SAML Response.  In addition, if the SP needs to support the SP-initiated Login flow, the toolkits also provide the logic needed to generate an appropriate SAML Authentication Request.</p>

<h3 id="single-idp-vs-multiple-idps">Single IDP vs Multiple IDPs</h3>

<p>If you are building an internal app and you want to SAML-enable it in order to integrate with your corporate SAML identity provider, then you are looking at supporting only a single IDP.  In this case, your app only needs to deal with a single set of IDP metadata (cert, endpoints, etc).</p>

<p><img src="/assets/saml_guidance_one_idp-a608c594e72ee484e731d30d6259dd59d18f527a4750e3c95ce12d43b09f90ec.png" single="" idp="" alt="Single IDP" /></p>

<p>If you are an ISV building an enterprise SaaS product, or if you are building an external facing website/portal/community for your customers and partners, then you need to look at supporting multiple IDPs.  This is the typical use case for many SaaS ISVs needing to integrate with customers’ corporate identity infrastructure.  Depending on the architecture of your application, you need to think about ways to store the SAML configuration (eg. Certificates, IDP login URLs) from each identity provider, as well as how you will provide the necessary SP information for each.</p>

<p><img src="/assets/saml_guidance_many_idp-29aaf3adeabf7aa0cd0be9b3d503e8c85ded5f92163249d43242b2ffeb44cbc9.png" many="" idps="" alt="Many IDPs" /></p>

<p>A key consideration involves the ACSurl endpoint on the SP side where SAML responses are posted. It is possible to expose a single endpoint even when dealing with multiple IDPs.  For a single-instance multi-tenant application where the tenancy is not defined in the URL (such as via a subdomain), this might be a simpler way to implement.  However, you must then rely on additional information in the SAML response to determine which IDP is trying to authenticate (for example, using the IssuerID).  If your application is architected in a multi-tenant fashion with domain information in the URL (for example, <em>https://domain1.myISV.com</em> or <em>https://www.myISV.com/domain1</em>), then having an ACSurl endpoint for each subdomain might be a good option since the URL itself identifies the domain.</p>

<p><img src="/assets/saml_guidance_many_idp_subdomain-7397a578ee616cadcf37ad6eea64b4c2a0fc581fc8b34da400a8b7159a8576cf.png" sps="" with="" subdomains="" alt="SP with subdomains" /></p>

<h3 id="understanding-sp-initiated-login-flow">Understanding SP-initiated Login Flow</h3>

<p>As discussed earlier, an IDP-initiated login flow starts from the IDP.  Since it begins on the IDP side, there is no additional context about what the user is trying to access on the SP side other than the fact that the user is trying to get authenticated and access the SP.  Typically, once the user is authenticated, the browser will be taken to a generic landing page in the SP.</p>

<p>In an SP-initiated flow, the user tries to access a protected resource directly on the SP side without the IDP being aware of the attempt.  Two issues arise.  First is the need to identify the right IDP if authentication of a federated identity is needed.  With SP-initiated login, the SP initially does not know anything about the identity.  As a developer, you need to figure out how the SP can determine which IDP should be receiving the SAML request.  In some cases, if your application URLs contain subdomain information that is mapped to a unique tenant and IDP, then the resource link being hit is enough to identify the IDP.  If this isn’t the case, then you might need to prompt the end user for additional information from the end user such as user id, email, or a company id; something that allows the SP to identify which IDP the user attempting to access the resource belongs to.  Remember, you are only prompting for an identifier, not credentials.</p>

<p>Another issue with SP-initiated login flow is the support for deep-links. Most applications support deep-links.  For example, you might receive a link to a document that resides on a content management system.  Ideally, if you need to authenticate prior to accessing the document, you would like to be taken to the document immediately after authentication.</p>

<p>SAML is an asynchronous protocol by design.  The SP-initiated login begins the flow by generating a SAML Authentication Request that gets redirected to the IDP.  At this point, the SP does not store any information about the request.  When the SAML response comes back from the IDP, the SP wouldn’t know anything about the initial deep-link that triggered the authentication request.  Luckily, SAML supports this with a parameter called RelayState.</p>

<p>A RelayState is an HTTP parameter that can be included as part of the SAML request and SAML response.  In an SP-initiated login flow, the SP can set the RelayState parameter in the SAML request with additional information about the request.  A SAML IDP, upon receiving the SAML request, will take the RelayState value and simply attach it back as a HTTP parameter in the SAML response after the user has been authenticated.  This way, when the round trip completes, the SP can use the RelayState information to get additional context about the initial SAML authentication request.</p>

<p>In the case of a deeplink, the SP will set the RelayState of the SAML request with the deep-link value.  When the SAML response comes back, the SP can use the RelayState value and take the authenticated user to the right resource.  Here is an example of the flow.</p>

<p><img src="/assets/saml_guidance_deeplink-33c4be41a41209d06eacd0d69b8b48fcb61e31fb596bff3747ffc15ff8a6397a.png" sp-initiated="" flow="" with="" deep="" link="" alt="SP-initiated Login with Deep Link" /></p>

<h3 id="exposing-saml-configuration-in-sp">Exposing SAML configuration in SP</h3>

<p>As discussed before, the SP needs the IDP configuration in order to complete the SAML setup.  While many ISVs choose to do this via support and email, the better way to do this is by exposing a self-service admin page for your customer’s IT administrator to enable SAML.  SAML supports metadata on both the IDP and SP side.  One way to configure the IDP/SP relationship on the SP side is to build the ability to receive an IDP metadata file and the ability to generate an SP metadata file for consumption by the IDP.  This is the preferred method.</p>

<p>However, some ISVs choose to allow configuration of several key SAML parameters directly rather than through a metadata file.  Typical parameters would include the IDP redirect URL (for SAML Request), IssuerID, IDP Logout URL.  The SP must also allow the IDP public certificate to be uploaded or saved.</p>

<p>Using a metadata file is preferred because it can handle any future additions/enhancements in your SAML support without making UI changes that would otherwise be required if you expose specific SAML configuration parameters in your UI.</p>

<h3 id="enabling-saml-for-everyone-vs-a-subset-of-users">Enabling SAML for everyone vs a subset of users</h3>

<p>Depending on the nature of your application, there might be reasons to allow only a subset of users to be SAML enabled.  Imagine an application that is accessed by internal employees and external users like partners.  The employees may SAML into the app, while the external users may use a separate set of credentials.
Even in cases where the intent is to have all the users of a particular tenant be SAML-enabled, it might be useful to enable just a subset of users during proof-of-concept, testing and roll-out to test out authentication with a smaller subset of users before going-live for the entire population.</p>

<h3 id="implementing-a-backdoor">Implementing a “backdoor”</h3>

<p>This is particularly important where the entire population is intended to be SAML-enabled in your application.  Sometimes, there might be a mistake in the SAML configuration – or something changes in SAML IDP endpoints.  In any case, you do not want to be completely locked out.  Having a backdoor available for administrator(s) to use to access a locked system becomes extremely important.  This is often accomplished by having a “secret” login URL that does not trigger a SAML redirection when accessed. Typically, the administrator will use a username/password to login in and make the necessary changes to fix the problem.</p>

<h2 id="saml-for-mobile-native-apps">SAML for Mobile Native Apps</h2>

<p>Because SAML is an HTTP-based protocol, supporting SAML in a native mobile app may seem tricky.  You can actually achieve this quite easily by including an embedded webview in your native app to support the HTTP redirects.  When launching the webview, make sure you hit a URL on the SP side that will trigger a SAML redirect back to the IDP.  From that point on, the webview will carry out the SP-initiated login flow as it would happen in a browser.  When the SP finally receives the SAML response and authenticates the user successfully, your native app can leave the webview and proceed with the rest of the login bootstrap which typically involves generating some sort of a token (for example, OAuth) which is stored by the native app for subsequent access.  This is a fairly common approach used by many ISVs to support SAML integration with enterprises.</p>

<p>For more details, see the <a href="/docs/guides/okta_mobile_connect.html">technical overview for Okta Mobile Connect</a>.</p>

<h2 id="testing-saml">Testing SAML</h2>

<p>Use the <a href="http://saml.oktadev.com/">Okta SAML validation tool</a> to speed up the process of developing a SAML SP.</p>

<p>This tool makes it easy for you to send SAML Requests to your SAML SP. It  allows you to quickly change the contents of the SAML requests and simplifies the process of debugging SAML issues by automatically decoding SAML payloads and displaying server headers for you.</p>

<p>You can also install the <a href="saml_tracer.html">SAML Tracer extension to Firefox</a> for testing, or similar tools for other browsers.</p>

<h2 id="saml-toolkits">SAML Toolkits</h2>

<p>OpenSource toolkits that implement the SAML 2.0 specification for the WebSSO Profile for Service Providers in different programming languages
can help you build your applications and integrations:</p>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/.NET_Framework_version_history">.NET Framework</a> 4.5 or above: <a href="https://github.com/KentorIT/authservices#kentor-authentication-services">Kentor Authentication Services</a></li>
  <li>.NET Framework 4 or below: <a href="http://www.componentspace.com/SAMLv20.aspx">ComponentSpace SAML 2.0</a> - Paid software, licenses start at $299</li>
  <li>Java: <a href="https://shibboleth.net/products/opensaml-java.html">OpenSAML</a></li>
  <li>Java/Spring: <a href="/code/java/spring_security_saml.html">Spring Security SAML</a></li>
  <li>PHP: <a href="/code/php//simplesamlphp.html">SimpleSAMLphp</a></li>
  <li>Python: <a href="/code/python/pysaml2.html">PySAML2</a></li>
  <li>Ruby: <a href="https://rubygems.org/gems/ruby-saml">Ruby-SAML</a></li>
</ul>

<blockquote>
  <p>Note: Okta doesn’t own or maintain these toolkits, though we do provide documentation to help you use them with Okta.</p>
</blockquote>

<h2 id="reference">Reference</h2>

<h3 id="saml-20">SAML 2.0</h3>

<ul>
  <li><a href="http://docs.oasis-open.org/security/saml/v2.0/saml-core-2.0-os.pdf">Assertions and Protocols for the OASIS Security Assertion Markup Language (SAML) V2.0</a></li>
  <li><a href="http://docs.oasis-open.org/security/saml/v2.0/saml-bindings-2.0-os.pdf">Bindings for the OASIS Security Assertion Markup Language (SAML) V2.0</a></li>
  <li><a href="http://docs.oasis-open.org/security/saml/v2.0/saml-profiles-2.0-os.pdf">Profiles for the OASIS Security Assertion Markup Language (SAML) V2.0</a></li>
</ul>

      </div>
      <div class="TableOfContents TableOfContentsPreload">
        <div class="TableOfContents-item is-level1">
          <script>
                  document.write(document.title.split('|')[0].trim());
          </script>
        </div>
        <div class="TableOfContentsLoader"></div>
      </div><!-- END Page Content -->
    </section><!-- END Page Center w/Sub Nav & Content -->

    <!-- START Footer -->
    <footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">

                <a class="Logo" href="/" rel="noopener noreferrer">
                    <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    Visit okta.com
                </a>

            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">

                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/platform-release-notes/platform-release-notes.html">Release Notes</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notes</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-0365dd27cf276cb2a15c0a43906ca592538204cf1ad4557547bf4e50609b411e.js"></script>
    <script type="text/javascript" src="/assets/quickstart-e49102fc1a13bd82d3a085763e9fd15d1d302c0f5b63852f292781f26c905367.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/docs-69bc61e9ef45544fd9e1a764f80f3ae15bb3fcd23f5dcdf454973ce926e0d717.js"></script>
    

    <!-- END Footer -->
  </div>
  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
