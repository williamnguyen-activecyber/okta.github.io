<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager
    }
	</script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
 	

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="A Developer's Guide To Docker - Docker Compose | Okta Developer" />
  <meta class="swiftype" name="summary" data-type="string" content="Good developers care as much about efficiency as they do about writing clean code. Containerization can add efficiency to both your workflow and your applica..." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-bdc44e64f3ccf409e81fcbd180b78cdc72901f2b97af69c18e6bb44dd908d3d2.css">
  
  
  <title>A Developer's Guide To Docker - Docker Compose | Okta Developer</title>
  <meta name="description" content="Good developers care as much about efficiency as they do about writing clean code. Containerization can add efficiency to both your workflow and your applica...">
  <link rel="canonical" href="https://developer.okta.com/blog/2017/10/11/developers-guide-to-docker-part-3">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#21313a">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first leaf">
          <a href="https://developer.okta.com/product/">Product</a>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/leebrandt" target="_blank"><i class="fa fa-github"></i></a>
		
		
		<a href="https://twitter.com/leebrandt" target="_blank"><i class="fa fa-twitter"></i></a>
		
		
		
		<a href="http://leebrandt.me" target="_blank"><i class="fa fa-external-link"></i></a>
		
	</div>
	
	

<article class="BlogPost">
	
	<header class="BlogPost-header">
	
		<time class="BlogPost-date" datetime="2017-10-11">October 11, 2017</time>
		
		<h1 class="BlogPost-title">
			
			A Developer's Guide To Docker - Docker Compose
			
		</h1>
		
		<div class="BlogPost-attribution">
			
				<img src="/assets/avatar-leebrandt-23a647548f26433d031856dcef1df5204763b94283cd68c397d816a61363a94d.jpg" alt="avatar-leebrandt.jpg" class="BlogPost-avatar">
			
			<span class="BlogPost-author">Lee Brandt</span>
		</div>
	
	</header>
	
	<div class="BlogPost-content">
		
	<p>Good developers care as much about efficiency as they do about writing clean code. Containerization can add efficiency to both your workflow and your application, and has thus become all the rage among modern dev. And, as a good developer, you know that manually creating containers from images using <code class="highlighter-rouge">docker run …</code> or even using the <code class="highlighter-rouge">Dockerfile</code> to create containers is less than ideal. How would you like to have one command that tells Docker to build the containers for the UI, the API, the database, and the cache server? Let me show you how that works with Docker Compose!</p>

<p>In this tutorial, you’ll take the base application from <a href="https://github.com/leebrandt/docker-compose-example">Github</a> and complete the <code class="highlighter-rouge">docker-compose.yml</code> file in it. This application uses <a href="https://nodejs.org">Node</a>, <a href="https://www.npmjs.com/">NPM</a> and <a href="https://www.mongodb.com">MongoDB</a>. Don’t worry about installing all those things, you only need Docker installed!</p>

<p>Just like the <code class="highlighter-rouge">Dockerfile</code>, the <code class="highlighter-rouge">docker-compose.yml</code> file tells Docker how to build what you need for your containers. Unlike the <code class="highlighter-rouge">Dockerfile</code>, it is written using the YAML file spec, and it does a lot more than just building one image.</p>
<h2 id="choose-your-docker-compose-version">Choose Your Docker Compose Version</h2>
<p>The first line of any <code class="highlighter-rouge">docker-compose.yml</code> file is the <code class="highlighter-rouge">version</code> setting. In this case, you’ll use version 3.3, so just tell Docker Compose that.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">version</span><span class="pi">:</span> <span class="s">‘3.3’</span>
</code></pre>
</div>

<p>You can see the documentation for <code class="highlighter-rouge">docker-compose</code> version 3 at <a href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a> and you can see what the differences are between versions.</p>

<h2 id="define-node-and-mongo-services">Define Node and Mongo Services</h2>
<p>Services are how Docker refers to each container you want to build in the docker-compose file. In this case, you’ll create two services: one for the NodeJS application, and one for the MongoDB database.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">services</span><span class="pi">:</span>
  <span class="s">app</span><span class="pi">:</span>
  <span class="s">db</span><span class="pi">:</span>
</code></pre>
</div>

<p>Remember that indention is how the YAML file format groups information, so indention is important. Here, you’ve indented the <code class="highlighter-rouge">app</code> and <code class="highlighter-rouge">db</code> services under the <code class="highlighter-rouge">services</code> tag. These can be named whatever you want. In this case <code class="highlighter-rouge">app</code> and ‘db` are just easiest to refer to. Now, you’ll put some meat on these two services.</p>

<p>First, tell Docker what image you want to build the <code class="highlighter-rouge">app</code> service from by specifying that you’ll be building from the <code class="highlighter-rouge">sample:1.0</code> image. So you’ll specify that indented under the <code class="highlighter-rouge">app</code> tag.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">app</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">sample:1.0</span>
</code></pre>
</div>

<p>Of course that image doesn’t exist, so you’ll need to let Docker know where to find the <code class="highlighter-rouge">Dockerfile</code> to build it by setting a build context. If you don’t, Docker will try to pull the image from Docker Hub and when that fails it will fail the <code class="highlighter-rouge">docker-compose</code> command altogether.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">app</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">sample:1.0</span>
  <span class="s">build</span><span class="pi">:</span> <span class="s">.</span>
</code></pre>
</div>
<p>Here, you’ve specified that the build context is the current directory, so when Docker can’t find the <code class="highlighter-rouge">sample:1.0</code> image locally, it will build it using the Dockerfile in the current directory.</p>

<p>Next, you’ll tell Docker what the container name should be once it’s built the image to create the container from.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code> <span class="s">app</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">sample:1.0</span>
  <span class="s">container_name</span><span class="pi">:</span> <span class="s">sample_app</span>
  <span class="s">build</span><span class="pi">:</span> <span class="s">.</span>
</code></pre>
</div>

<p>Now, when Docker builds the image, it will immediately create a container named <code class="highlighter-rouge">sample_app</code> from that image.</p>

<p>By default, NodeJS apps run on port 3000, so you’ll need to map that port to 80, since this is the “production” <code class="highlighter-rouge">docker-compose</code> file. You do that using the <code class="highlighter-rouge">ports</code> tag in YAML.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">app</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">sample:1.0</span>
  <span class="s">container_name</span><span class="pi">:</span> <span class="s">sample_app</span>
  <span class="s">build</span><span class="pi">:</span> <span class="s">.</span>
  <span class="s">ports</span><span class="pi">:</span> 
    <span class="pi">-</span> <span class="s">80:3000</span>
</code></pre>
</div>

<p>Here, you’ve mapped port 80 on the host operating system, to port 3000 from the container. That way, when you’ve moved this container to a production host, users of the application can go to the host machine’s port 80 and have those requests answered from the container on port 3000.</p>

<p>Your application will be getting data from a MongoDB database and to do that the application will need a connection string that it will get from an environment variable called “MONGO_URI”. To set environment variables in the container once it’s built, use the <code class="highlighter-rouge">environment</code> tag in the YAML file.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">app</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">sample:1.0</span>
  <span class="s">container_name</span><span class="pi">:</span> <span class="s">sample_app</span>
  <span class="s">build</span><span class="pi">:</span> <span class="s">.</span>
  <span class="s">ports</span><span class="pi">:</span> 
    <span class="pi">-</span> <span class="s">80:3000</span>
  <span class="s">environment</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">MONGO_URI=mongodb://sampledb/sample</span>
</code></pre>
</div>

<h2 id="create-a-docker-network">Create a Docker Network</h2>
<p>For the application service to actually be able to reach the sample database, it will need to be on the same network. To put both of these services on the same network, create one in the <code class="highlighter-rouge">docker-compose</code> file by using the <code class="highlighter-rouge">networks</code> tag at the top level (the same level of indention as the <code class="highlighter-rouge">services</code> tag.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.3'</span>

<span class="s">services</span><span class="pi">:</span>
  <span class="s">app:...</span>
  <span class="s">db:...</span>
<span class="s">networks</span><span class="pi">:</span>
  <span class="s">samplenet</span><span class="pi">:</span>
    <span class="s">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</code></pre>
</div>

<p>This creates a network called “samplenet” using a bridge type network. This will allow the two containers to communicate over a virtual network between them.</p>

<p>Back in the app section of the file, join the app service to the “samplenet” network:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">app</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">sample:1.0</span>
  <span class="s">container_name</span><span class="pi">:</span> <span class="s">sample_app</span>
  <span class="s">build</span><span class="pi">:</span> <span class="s">.</span>
  <span class="s">ports</span><span class="pi">:</span> 
    <span class="pi">-</span> <span class="s">80:3000</span>
  <span class="s">environment</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">MONGO_URI=mongodb://sampledb/sample</span>
  <span class="s">networks</span><span class="pi">:</span> 
    <span class="pi">-</span> <span class="s">samplenet</span>
</code></pre>
</div>
<h2 id="create-the-mongodb-service">Create the MongoDB Service</h2>
<p>Now the app service is ready, but it won’t be much good without the db service. So add the same kinds of things in the next section for the db service.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code> <span class="s">db</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">mongo:3.0.15</span>
  <span class="s">container_name</span><span class="pi">:</span> <span class="s">sample_db</span>
  <span class="s">networks</span><span class="pi">:</span>
    <span class="s">samplenet</span><span class="pi">:</span>
      <span class="s">aliases</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">sampledb"</span>
</code></pre>
</div>

<p>This service builds from the official MongoDB 3.0.15 image and creates a container named “sample_db”. It also joins the “samplenet” network with an alias of “sampledb”. This is like a DNS name on a physical network, it allows other services on the “samplenet” network to refer to it by its alias. This is important because without it, the app service would have a much harder time talking to it. (I don’t know that it <em>couldn’t</em>, it would just probably have to use the container’s full hash!)</p>

<h2 id="use-docker-volumes">Use Docker Volumes</h2>
<p>You’ll also want to create a volume mount in the database service. Volumes allow you to mount folders on the host machine to folders in the container. Meaning, when something inside the container refers to a folder, it will actually be accessing a folder on the host machine. This is especially helpful for database containers because containers are meant to be disposable. With a mount to the physical folder on the host machine, you’ll be able to destroy a container and rebuild it and the data files for the container will still be there on the host machine. So add a volume tag in the db section mounting the <code class="highlighter-rouge">/data/db</code> folder in the container (where Mongo stores its data) to the <code class="highlighter-rouge">db</code> folder in your application’s root folder so that the final db section looks like the following.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">db</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">mongo:3.0.15</span>
  <span class="s">container_name</span><span class="pi">:</span> <span class="s">sample_db</span>
  <span class="s">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">./db:/data/db</span>
  <span class="s">networks</span><span class="pi">:</span>
    <span class="s">samplenet</span><span class="pi">:</span>
      <span class="s">aliases</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">sampledb"</span>
</code></pre>
</div>

<h2 id="review-your-docker-compose-file">Review Your Docker Compose File</h2>
<p>With all that done, your final docker-compose.yml file should look like:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.3'</span>

<span class="s">services</span><span class="pi">:</span>
  <span class="s">app</span><span class="pi">:</span>
    <span class="s">image</span><span class="pi">:</span> <span class="s">sample:1.0</span>
    <span class="s">container_name</span><span class="pi">:</span> <span class="s">sample_app</span>
    <span class="s">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="s">ports</span><span class="pi">:</span> 
      <span class="pi">-</span> <span class="s">80:3000</span>
    <span class="s">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">MONGO_URI=mongodb://sampledb/sample</span>
    <span class="s">depends_on</span><span class="pi">:</span> 
      <span class="pi">-</span> <span class="s">db</span>
    <span class="s">networks</span><span class="pi">:</span> 
      <span class="pi">-</span> <span class="s">samplenet</span>
  <span class="s">db</span><span class="pi">:</span>
    <span class="s">image</span><span class="pi">:</span> <span class="s">mongo:3.0.15</span>
    <span class="s">container_name</span><span class="pi">:</span> <span class="s">sample_db</span>
    <span class="s">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./db:/data/db</span>
    <span class="s">networks</span><span class="pi">:</span>
      <span class="s">samplenet</span><span class="pi">:</span>
        <span class="s">aliases</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">sampledb"</span>
<span class="s">networks</span><span class="pi">:</span>
  <span class="s">samplenet</span><span class="pi">:</span>
    <span class="s">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</code></pre>
</div>

<p>With that all done, you should be able to save the file and run <code class="highlighter-rouge">docker-compose up -d</code> in the folder where you docker-compose.yml file is and watch Docker build and start your environment for you.</p>

<p>If everything completes successfully, you can then go to <a href="http://localhost/users">http://localhost/users</a> and see something like the image below.</p>

<p><img src="/assets/blog/docker-for-developers/docker-compose-running-6008d9a7ebd36eb2e08888009b91d1cc36bab31523d4e1c47fe157b5ae02cd66.png" alt="Docker Compose Running" width="800" /></p>

<p>Congratulations! You have a complete environment that is defined in your source code. It can be versioned and checked in to source control. This is what people refer to as “Infrastructure as Code”. It also means that recreating this environment on the test, staging and production environments is as easy as running <code class="highlighter-rouge">docker-compose up -d</code> on the corresponding machine! I <em>told</em> you good developers are lazy!</p>

<h2 id="learn-more">Learn More</h2>
<p>You can learn more about <a href="https://docs.docker.com/compose/compose-file/">Docker Compose</a> and <a href="https://docs.docker.com/">Docker</a> in general from their respective documentation. If you want to learn more about the <code class="highlighter-rouge">Dockerfile</code> used in this project, check out <a href="https://developer.okta.com/blog/2017/08/28/developers-guide-to-docker-part-2">part two of this series on the <code class="highlighter-rouge">Dockerfile</code></a>.</p>

<p>As always, if you have any questions or comments about this, or any, of my articles, feel free to hit me up on <a href="https://twitter.com/leebrandt">Twitter</a> or <a href="https://github.com/leebrandt">Github</a>.</p>


	</div>
	
</article>

		
</section>

		
	</div><footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">

                <a class="Logo" href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    Visit okta.com
                </a>

            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">

                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/platform-release-notes/platform-release-notes.html">Release Notes</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-0365dd27cf276cb2a15c0a43906ca592538204cf1ad4557547bf4e50609b411e.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
